{% extends "base.html" %}

{% block content %}
<div style="padding: 40px 20px; max-width: 1400px; margin: 0 auto;">
    <h2 style="color: var(--primary-green); margin-bottom: 30px; text-align: center; font-size: 2.5rem;">Your Order History</h2>

    {% if orders %}
        <div style="display: flex; flex-direction: column; gap: 25px;">
            {% for order in orders %}
                <div style="background: var(--white); border-radius: 15px; box-shadow: var(--shadow); overflow: hidden; border: 2px solid transparent; transition: all 0.3s ease;">

                    <!-- Order Header -->
                    <div style="background: linear-gradient(135deg, var(--primary-green), var(--dark-green)); color: var(--white); padding: 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <div>
                            <h3 style="margin: 0; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                                üìã Order #{{ order.id }}
                            </h3>
                            <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 0.95rem;">
                                Placed on {{ order.date }} ‚Ä¢ {{ order.total_items }} item{{ 's' if order.total_items != 1 else '' }}
                            </p>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.4rem; font-weight: bold; margin-bottom: 5px;">
                                {{ order.total | currency_idr }}
                            </div>
                            <div>
                                {% if order.status == 'Delivered' %}
                                    <span style="background: var(--success-green); color: var(--white); padding: 8px 15px; border-radius: 25px; font-size: 0.9rem; font-weight: 500; display: inline-flex; align-items: center; gap: 5px;">
                                        ‚úì {{ order.status }}
                                    </span>
                                {% elif order.status == 'Shipped' %}
                                    <span style="background: var(--primary-yellow); color: var(--text-dark); padding: 8px 15px; border-radius: 25px; font-size: 0.9rem; font-weight: 500; display: inline-flex; align-items: center; gap: 5px;">
                                        üöö {{ order.status }}
                                    </span>
                                {% elif order.status == 'Processing' %}
                                    <span style="background: #3498db; color: var(--white); padding: 8px 15px; border-radius: 25px; font-size: 0.9rem; font-weight: 500; display: inline-flex; align-items: center; gap: 5px;">
                                        ‚è≥ {{ order.status }}
                                    </span>
                                {% else %}
                                    <span style="background: var(--text-light); color: var(--white); padding: 8px 15px; border-radius: 25px; font-size: 0.9rem; font-weight: 500;">
                                        {{ order.status }}
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Order Items -->
                    <div style="padding: 20px;">
                        <h4 style="color: var(--primary-green); margin-bottom: 15px; font-size: 1.1rem; border-bottom: 2px solid var(--bg-light); padding-bottom: 8px;">
                            Order Items
                        </h4>

                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            {% for item in order["items"] %}
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: var(--bg-light); border-radius: 10px; border-left: 4px solid var(--primary-green);">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--text-dark); margin-bottom: 3px; font-size: 1rem;">
                                            {{ item.name }}
                                        </div>
                                        <div style="font-size: 0.85rem; color: var(--text-light); margin-bottom: 3px;">
                                            SKU: {{ item.sku }}
                                        </div>
                                        <div style="font-size: 0.9rem; color: var(--primary-green); font-weight: 500;">
                                            {{ item.quantity }} √ó {{ item.price | currency_idr }}
                                        </div>
                                    </div>
                                    <div style="text-align: right; font-weight: bold; color: var(--primary-green); font-size: 1.1rem;">
                                        {{ (item.quantity * item.price) | currency_idr }}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>

                        <!-- Order Summary -->
                        <div style="margin-top: 20px; padding-top: 15px; border-top: 2px solid var(--bg-light);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="font-size: 1.1rem; font-weight: 600; color: var(--text-dark);">
                                    Total Order Value:
                                </div>
                                <div style="font-size: 1.3rem; font-weight: bold; color: var(--primary-green);">
                                    {{ order.total | currency_idr }}
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                            {% if order.status == 'Processing' %}
                                <form method="POST" action="{{ url_for('cancel_order', order_id=order.id) }}" style="display:inline;">
                                    <button type="submit"
                                        style="background: var(--error-red); color: var(--white); padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;">
                                        Cancel Order
                                    </button>
                                </form>
                            {% endif %}

                            {% if order.status == 'Shipped' %}
                                <a href="{{ url_for('track_package', order_id=order.id) }}" style="text-decoration:none;">
                                    <button
                                        style="background: var(--primary-yellow); color: var(--text-dark); padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;">
                                        Track Package
                                    </button>
                                </a>
                            {% endif %}

                            {% if order.status == 'Delivered' %}
                                <a href="#" style="text-decoration:none;">
                                    <button
                                        style="background: var(--primary-green); color: var(--white); padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;">
                                        Reorder Items
                                    </button>
                                </a>
                                <a href="#" style="text-decoration:none;">
                                    <button
                                        style="background: var(--light-green); color: var(--white); padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;">
                                        Leave Review
                                    </button>
                                </a>
                            {% endif %}

                            <a href="{{ url_for('order_details', order_id=order.id) }}" style="text-decoration:none;">
                                <button
                                    style="background: var(--white); color: var(--primary-green); padding: 10px 20px; border: 2px solid var(--primary-green); border-radius: 8px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;">
                                    View Details
                                </button>
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Pagination (for future use) -->
        <div style="text-align: center; margin-top: 40px;">
            <p style="color: var(--text-light); font-size: 0.9rem;">
                Showing {{ orders|length }} order{{ 's' if orders|length != 1 else '' }}
            </p>
        </div>

    {% else %}
        <div style="text-align: center; padding: 60px 20px; background: var(--bg-light); border-radius: 15px; margin-top: 2rem;">
            <div style="font-size: 4rem; margin-bottom: 20px; color: var(--text-light);">üì¶</div>
            <h3 style="color: var(--text-dark); margin-bottom: 15px;">No Orders Yet</h3>
            <p style="color: var(--text-light); margin-bottom: 30px;">You haven't placed any orders yet. Start shopping to see your order history here!</p>
            <a href="{{ url_for('home') }}" style="text-decoration: none;">
                <button style="background: var(--primary-green); color: var(--white); padding: 15px 30px; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s ease;">
                    üõí Start Shopping
                </button>
            </a>
        </div>
    {% endif %}

    <div style="text-align: center; margin-top: 30px;">
        <a href="{{ url_for('home') }}" style="color: var(--primary-green); text-decoration: none; font-weight: 500; transition: color 0.3s ease; font-size: 1rem;">
            ‚Üê Back to Home
        </a>
    </div>
</div>
{% endblock %}
